<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive Experience | Production Ready</title>
    
    <!-- GSAP (Core Animation Engine) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- RESET & BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            width: 100%; height: 100%; 
            background-color: #000; 
            overflow: hidden; /* Evita scroll durante la experiencia */
            font-family: sans-serif;
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999;
            display: flex; justify-content: center; align-items: center;
            color: #fff; text-transform: uppercase; letter-spacing: 2px; font-size: 12px;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        /* --- ESCENARIO PRINCIPAL --- */
        .hero-immersive {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .video-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* --- CAPA DE VIDEO --- */
        video {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover; /* Mantiene la inmersión sin deformar */
            opacity: 0;
            transition: opacity 0.6s ease; /* Crossfade suave nativo + GSAP helper */
            will-change: opacity;
        }

        video.active {
            opacity: 1;
            z-index: 2;
        }

        video.hidden {
            opacity: 0;
            z-index: 1;
        }

        /* --- CAPA DE INTERACCIÓN (SVG INVISIBLE) --- */
        .interaction-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            /* Se mantiene oculta hasta que arranca el loop */
            visibility: hidden; 
        }

        svg {
            width: 100%; height: 100%;
            /* IMPORTANTE: preserveAspectRatio asegura que el SVG se estire igual que el video (object-fit: cover) */
            /* Si el video es 16:9, usar 'xMidYMid slice' es crucial */
        }

        .interaction-zone {
            fill: transparent; /* Totalmente invisible */
            cursor: pointer;
            pointer-events: auto;
            transition: fill 0.3s ease;
        }

        /* Feedback visual sutil al usuario (Opcional) */
        /* Esto ayuda a descubrir que es interactivo sin romper la inmersión */
        .interaction-zone:hover {
            fill: rgba(255, 255, 255, 0.05); 
        }

    </style>
</head>
<body>

    <!-- PRELOADER -->
    <div id="loader">Cargando Experiencia...</div>

    <section class="hero-immersive">
        
        <!-- CAPA DE VIDEOS -->
        <div class="video-container">
            <!-- 1. INTRO -->
            <video id="vid-intro" class="active" muted playsinline preload="auto">
                <source src="https://pub-8275440e24554b96ad7dd640df0866b9.r2.dev/videos/Tejido.mp4" type="video/mp4">
            </video>

            <!-- 2. LOOP (Bucle de las cintas) -->
            <video id="vid-loop" class="hidden" loop muted playsinline preload="auto">
                <source src="https://pub-8275440e24554b96ad7dd640df0866b9.r2.dev/videos/Tejido2.mp4" type="video/mp4">
            </video>

            <!-- 3. TRANSICIÓN (Source dinámico) -->
            <video id="vid-transition" class="hidden" muted playsinline>
                <!-- Se inyecta por JS -->
            </video>
        </div>

        <!-- CAPA DE INTERACCIÓN SVG -->
        <!-- Ajusta el viewBox a la resolución nativa de tu video (ej: 1920 1080) -->
        <div class="interaction-layer" id="interaction-layer">
            <svg viewBox="0 0 1920 1080" preserveAspectRatio="xMidYMid slice">
                
                <!-- IMPORTANTE: Reemplaza los atributos d="..." con tus trazados reales -->
                
                <!-- CINTA AMARILLA -->
                <path id="zone-yellow" class="interaction-zone" 
                      data-color="Yellow" data-url="https://virtuala-soft.github.io/earth/dsc/wayuu/amarilla.html"
                      d="M376,245c-7,0-246-145-246-145h150.52l208.48-28,318,25,156-9,114,9,22-44s-65-12-76-11-161.18-.06-161.18-.06l-247.32-17.45-173.5-8.49L240,0h-84.93l-90.07,17-51-3L0,44l35,74,35,81,233,140,239,127,115,28,104,36,28-90s-406-195-413-195Z"></path>
                
                <!-- CINTA AZUL -->
                <polygon id="zone-blue" class="interaction-zone" 
                      data-color="Blue" data-url="https://virtuala-soft.github.io/earth/dsc/wayuu/azul.html"
                      points="93 109.59 250.36 266.96 335 379.59 516 496.59 632 519.59 478 383.59 284 233.59 107 86.59 0 72.59 8 0 139 17.59 236 82.59 383 190.59 546 328.59 632 408.15 657 469.59 657 547.73 627.8 576.93 508 544.59 349 446.59 156.88 288.47 88 204.59 0 72.59 70 77.59 93 109.59"></polygon>

                <!-- CINTA ROJA -->
                <path id="zone-red" class="interaction-zone" 
                      data-color="Red" data-url="https://virtuala-soft.github.io/earth/dsc/wayuu/roja.html"
                      d="M84.64,613l-49,32L0,613v-50.83l15.64-56.17,119-96,129.58-129.58,158.42-128.42s139-126,146-127S669.64,0,669.64,0l25,55s-174.15,186.15-186.57,186.57-117.59,80.93-117.59,80.93c0,0-143.54,143.87-143.69,143.69s-121.25,120.91-121.2,120.86-40.95,25.95-40.95,25.95Z"></path>

                <!-- CINTA VERDE -->
                <path id="zone-green" class="interaction-zone" 
                      data-color="Green" data-url="https://virtuala-soft.github.io/earth/dsc/wayuu/verde.html"
                      d="M249.61,470L799.61,205l120-85s-249-47-253-47-139-13-139-13l-205,34L39.61,136,0,96.39l55.6-36.39L232.61,25l215-16L691.61,0l131,13,173,40,37,94-11,48-150,118s-83,45-92,49-255.79,108-255.79,108l-146.21,66-71-18-53-14-4-34Z"></path>

            </svg>
        </div>

    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- CONFIGURACIÓN ---
            const videoPathPrefix = "https://pub-8275440e24554b96ad7dd640df0866b9.r2.dev/videos/"; // Si los videos están en una carpeta, pon: "assets/videos/"
            
            // --- REFERENCIAS DOM ---
            const loader = document.getElementById('loader');
            const vidIntro = document.getElementById('vid-intro');
            const vidLoop = document.getElementById('vid-loop');
            const vidTrans = document.getElementById('vid-transition');
            const interactionLayer = document.getElementById('interaction-layer');
            const zones = document.querySelectorAll('.interaction-zone');

            let isTransitioning = false; // Flag para evitar dobles clics

            // --- 1. INICIALIZACIÓN ---
            // Esperamos a que el intro tenga suficiente data para reproducir
            vidIntro.addEventListener('canplaythrough', () => {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 600);
                vidIntro.play().catch(e => console.log("Autoplay bloqueado por navegador, requiere interacción."));
            }, { once: true });

            // Fallback por si 'canplaythrough' ya ocurrió
            if (vidIntro.readyState >= 3) {
                loader.style.opacity = '0';
                vidIntro.play();
            }

            // --- 2. ORQUESTACIÓN INTRO -> LOOP ---
            vidIntro.addEventListener('ended', () => {
                // Iniciamos reproducción del loop ANTES de mostrarlo (seamless)
                vidLoop.play();

                // Crossfade
                vidIntro.classList.remove('active');
                vidIntro.classList.add('hidden');
                
                vidLoop.classList.remove('hidden');
                vidLoop.classList.add('active');

                // Activamos la capa de interacción
                interactionLayer.style.visibility = 'visible';
                
                // Animación de entrada para las zonas (opcional, mejora UX)
                gsap.fromTo(zones, 
                    { autoAlpha: 0 }, 
                    { autoAlpha: 1, duration: 1, ease: "power2.out" }
                );
            });

            // --- 3. INTERACCIÓN (CLICS) ---
            zones.forEach(zone => {
                zone.addEventListener('click', () => {
                    if (isTransitioning) return;
                    
                    const color = zone.dataset.color; // Ej: "Yellow"
                    const targetUrl = zone.dataset.url;
                    
                    triggerTransition(color, targetUrl);
                });
            });

            // --- 4. LÓGICA DE TRANSICIÓN ---
            function triggerTransition(colorName, url) {
                isTransitioning = true;
                
                // Desactivar interacción inmediatamente
                interactionLayer.style.pointerEvents = 'none';

                // Definir fuente del video de transición
                // Estructura esperada: "https://pub-8275440e24554b96ad7dd640df0866b9.r2.dev/videos/TransitionCintaYellow.mp4"
                const videoFile = `${videoPathPrefix}TransitionCinta${colorName}.mp4`;
                vidTrans.src = videoFile;
                vidTrans.load();

                // Cuando el video de transición esté listo
                vidTrans.oncanplaythrough = () => {
                    vidTrans.play();

                    // Switch visual Loop -> Transición
                    vidLoop.classList.remove('active');
                    vidLoop.classList.add('hidden'); // Opcional: pausar vidLoop aquí para ahorrar CPU

                    vidTrans.classList.remove('hidden');
                    vidTrans.classList.add('active');
                };

                // --- 5. FIN Y REDIRECCIÓN ---
                vidTrans.onended = () => {
                    // Fade out a negro (o blanco) antes de cambiar de página
                    gsap.to(vidTrans, {
                        opacity: 0,
                        duration: 0.8,
                        onComplete: () => {
                            window.location.href = url;
                        }
                    });
                };
            }

            // --- OPTIMIZACIÓN ---
            // Aseguramos que los videos ocultos se pausen para no consumir recursos
            // (Excepto durante los crossfades cortos)
        });
    </script>
</body>
</html>
